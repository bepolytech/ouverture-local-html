<meta id="refresh" http-equiv="refresh" content="120"><!-- refresh every 2 * 60 sec -->
<div style="text-align:center; padding: 16px;"><div id="status">Please activate JavaScript</div></div>
<script type="text/javascript">
document.getElementById('status').innerHTML = `Loading...`;
function toggleRefresh() {
        var metaTag = document.getElementById('refresh');
        if (metaTag.getAttribute("content") === "3600") {
          metaTag.setAttribute("content", "120");
          document.getElementById('refresh-button').innerHTML = `<span style="color: blue;"><i class="fas fa-sync-alt"></i></span> Refresh automatique activé`;
        } else {
          metaTag.setAttribute("content", "3600");
          document.getElementById('refresh-button').innerHTML = `<span style="color: red;"><i class="fas fa-times"></i></span> Refresh automatique désactivé`;
        }
      };
fetch('https://devociarm.placentino.be/local/') //https://api.bepolytech.be , https://devociarm.placentino.be/local/
  .then(response => response.json())
  .then(data => {
    let text = '';
    let color = '';
    let style = '';
    let info = data.info;
    let temp = data.temperature;
    let hum = data.humidity;
    //let updateTime = data.update_time;
    let updateTimeUnix = data.update_time_unix;
    console.log(data);

    if (data.door_state === 1) {
      text = 'OUVERT';
      color = '#00bf00';
    } else if (data.door_state === 0) {
      text = 'FERMÉ';
      color = '#bf0000';
    } else if (data.door_state === 2) {
      text = 'INCONNU';
      color = '#d4d4d4';
      style = 'font-style: italic;';
    } else {
      text = 'ÉTAT INCONNU';
      color = '#d4d4d4';
      style = 'font-style: italic;';
    }

    let d = new Date(updateTimeUnix*1000);
    let localeString = d.toLocaleString("fr", { timezone: "Europe/Brussels" });
    let updateTimeHour = localeString.slice(11, -3);
    let updateTimeDate = localeString.slice(0, 10);
    let updateTime = localeString.slice(11, -3) + " " + localeString.slice(0,10);

    // Display the information
    console.log('Temperature:', temp);
    console.log('Humidity:', hum);
    console.log('Door State:', text);
    console.log('Info:', info);
    console.log('Update Time:', updateTime);
    console.log('Update Time Unix:', updateTimeUnix);

    let status = document.getElementById('status');
    status.innerHTML = `<div style="padding: 4px 16px; border:2px solid black; border-radius: 5px; display: inline-block; vertical-align: middle;"><h3 style="margin-top: 4px">Le local est <strong><br> <u><span style="color: ${color}; ${style}; font-size:36px;">${text}</span></strong></u><br>au public</h3></div><br><p style="padding-top: 8px">Info: ${info}<br>Dernière update: <strong>${updateTimeHour}</strong> (${updateTimeDate})<br><div style="vertical-align: middle; display: inline-block; text-align:right">Température: <strong>${temp}°C</strong><br>Humidité: <strong>${hum}%</strong></div></p>`;

    console.log("BEP API get successful");

  })
  .catch(error => {
    let status = document.getElementById('status');
    status.innerHTML = `<div style="padding: 4px 16px; border:2px solid black; border-radius: 5px; display: inline-block; vertical-align: middle;"><h3 style="margin-top: 4px">Le local est <strong><br> <u><span style="color: #d4d4d4; font-style: italic; font-size:36px;">ÉTAT INCONNU</span></strong></u><br>au public</h3></div><br><p style="color: #781f1f;padding-top: 8px"><strong>API Error: ${error}</strong><br>Dernière update: INCONNUE<br><div style="vertical-align: middle; display: inline-block; text-align:right">Température: <strong>INCONNUE</strong><br>Humidité: <strong>INCONNUE</strong></div></p>`;

    console.log(error);

    console.error(error);

  });

//setInterval(() => {
//  location.reload();
//}, 2 * 60 * 1000); // milliseconds: 2 * 60 * 1000 = 2min
</script>

<p style="text-align:center">
  <button onClick="window.location.reload();" style="background-color: #000000;
        font-size: 20px;
        color: white;
        border: 1px solid #ffffff;
        padding: 8px 16px;
        border-top-left-radius: 5px;
        border-top-right-radius: 5px;
        cursor: pointer;
        text-decoration: none;
        text-align:center;">
    Refresh
  </button>
<br>
  <button id="refresh-button" type="button" style="text-align:center;
        background-color: transparent
        border: 1px solid #ffffff;
        border-radius: 5px;
        //color: white;
        padding: 4px 8px;
        text-align: center;
        text-decoration: underline;
        display: inline-block;
        font-size: 12px;
        margin: -2px 2px;
        cursor: pointer;" onclick="toggleRefresh()">
    <span id="toggleIcon"><span style="color: blue;"><i class="fas fa-sync-alt"></i></span> Refresh automatique activé</span>
  </button>
</p>
